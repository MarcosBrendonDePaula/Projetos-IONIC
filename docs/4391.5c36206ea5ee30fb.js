"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4391],{4391:(Z,m,r)=>{r.r(m),r.d(m,{MetronomoPageModule:()=>b});var p=r(9808),h=r(4182),i=r(3509),u=r(1e3),g=r(655),t=r(2096);function _(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"ion-button",15),t.NdJ("click",function(){return t.CHM(o),t.oxw().metronomeSwitch()}),t._UZ(1,"ion-icon",16),t.qZA()}}function d(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"ion-button",15),t.NdJ("click",function(){return t.CHM(o),t.oxw().metronomeSwitch()}),t._UZ(1,"ion-icon",17),t.qZA()}}const f=[{path:"",component:(()=>{class e{constructor(){this.bpm=60,this.bpm_limit=500,this.Vars={playing:!1,lastTick:0,proxTick:0,step_time:1e3,initAs:0},this.grid_class={"ion-grid":!0,"ion-align-items-center":!0},this.tap_bpm={tap_times:[],last_time:void 0},e.obj=this}ngOnInit(){return(0,g.mG)(this,void 0,void 0,function*(){this.audioContext=new AudioContext,this.audioBuffer=yield fetch("assets/metronomo/audio/tick.wav").then(o=>o.arrayBuffer()).then(o=>this.audioContext.decodeAudioData(o)),e.obj=this})}ngOnDestroy(){this.Vars.playing&&(window.cancelAnimationFrame(this.Vars.anim_frame),this.Vars.playing=!1,this.Vars.lastTick=0,this.Vars.proxTick=0)}playTick(){return(0,g.mG)(this,void 0,void 0,function*(){this.audioSource=this.audioContext.createBufferSource(),this.audioSource.buffer=this.audioBuffer,this.audioSource.connect(this.audioContext.destination),this.audioSource.start()})}prepLoop(o){let n=e.obj;n.Vars.proxTick=o+n.Vars.step_time,n.Vars.anim_frame=window.requestAnimationFrame(n.loop)}loop(o){let n=e.obj;n.Vars.anim_frame=window.requestAnimationFrame(n.loop),o>=n.Vars.proxTick&&(n.playTick(),n.Vars.proxTick=o+n.Vars.step_time-(o-n.Vars.proxTick),n.Vars.lastTick=o)}metronomeSwitch(){if(this.Vars.playing)return window.cancelAnimationFrame(this.Vars.anim_frame),this.Vars.playing=!1,this.Vars.lastTick=0,void(this.Vars.proxTick=0);this.Vars.playing=!0,this.Vars.anim_frame=window.requestAnimationFrame(this.prepLoop)}bpmChange(){this.Vars.step_time=6e4/this.bpm}addBpm(){this.bpm!=this.bpm_limit&&(this.bpm+=1,this.bpmChange())}remBpm(){1!=this.bpm&&(this.bpm-=1,this.bpmChange())}bpmRangeEdit(o){this.bpm=o.detail.value,this.bpmChange()}getAverage(o,n){let a=o,c=0;for(let l=a.length-1;l>=0&&(c+=a[l],!(a.length-l>=n));l--);return c/5}TapBpm(){this.tap_bpm.tap_times.push((new Date).getTime());let o=[];if(this.tap_bpm.tap_times.length>=2){for(let n=1;n<this.tap_bpm.tap_times.length;n++)o.push(Math.round(60/(this.tap_bpm.tap_times[n]/1e3-this.tap_bpm.tap_times[n-1]/1e3)*100)/100);this.bpm=Math.round(this.getAverage(o,5))}this.playTick()}ResetTapBpm(){this.tap_bpm.tap_times=[],this.bpm=60}}return e.obj=null,e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-metronomo"]],decls:33,vars:5,consts:[[1,"Menu"],["size","3"],["expand","block","color","warning",3,"click"],["name","remove-outline"],["size","6",1,"bpm_value"],["expand","block","color","success",3,"click"],["name","add-outline"],["size","4"],["expand","block","color","dark",3,"click",4,"ngIf"],["size","12"],["min","1","dualKnobs","false","pin","true","snaps","true","step","1","ticks","true","color","primary",1,"bpmRange",3,"max","value","ionChange"],[1,"TapBpm"],["size","6"],["expand","block","color","success",3,"click","keyup"],["expand","block","color","danger",3,"click"],["expand","block","color","dark",3,"click"],["name","play-outline"],["name","pause-outline"]],template:function(o,n){1&o&&(t.TgZ(0,"ion-header"),t.TgZ(1,"ion-toolbar"),t.TgZ(2,"ion-title"),t._uU(3,"Metronomo"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(4,"ion-content"),t.TgZ(5,"ion-grid"),t.TgZ(6,"div",0),t.TgZ(7,"ion-row"),t.TgZ(8,"ion-col",1),t.TgZ(9,"ion-button",2),t.NdJ("click",function(){return n.remBpm()}),t._UZ(10,"ion-icon",3),t.qZA(),t.qZA(),t.TgZ(11,"ion-col",4),t.TgZ(12,"span"),t._uU(13),t.qZA(),t.qZA(),t.TgZ(14,"ion-col",1),t.TgZ(15,"ion-button",5),t.NdJ("click",function(){return n.addBpm()}),t._UZ(16,"ion-icon",6),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"ion-row",0),t._UZ(18,"ion-col",7),t.TgZ(19,"ion-col"),t.YNc(20,_,2,0,"ion-button",8),t.YNc(21,d,2,0,"ion-button",8),t.qZA(),t._UZ(22,"ion-col",7),t.qZA(),t.TgZ(23,"ion-row"),t.TgZ(24,"ion-col",9),t.TgZ(25,"ion-range",10),t.NdJ("ionChange",function(c){return n.bpmRangeEdit(c)}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"ion-row",11),t.TgZ(27,"ion-col",12),t.TgZ(28,"ion-button",13),t.NdJ("click",function(){return n.TapBpm()})("keyup",function(){return n.TapBpm()}),t._uU(29," TAPBPM "),t.qZA(),t.qZA(),t.TgZ(30,"ion-col",12),t.TgZ(31,"ion-button",14),t.NdJ("click",function(){return n.ResetTapBpm()}),t._uU(32," RESET "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o&&(t.xp6(13),t.hij("",n.bpm,"BPM"),t.xp6(7),t.Q6J("ngIf",!n.Vars.playing),t.xp6(1),t.Q6J("ngIf",n.Vars.playing),t.xp6(4),t.s9C("max",n.bpm_limit),t.s9C("value",n.bpm))},directives:[i.Gu,i.sr,i.wd,i.W2,i.jY,i.Nd,i.wI,i.YG,i.gu,p.O5,i.I_,i.QI],styles:["ion-grid[_ngcontent-%COMP%]{height:100%}ion-grid[_ngcontent-%COMP%]   .Menu[_ngcontent-%COMP%]{height:10%;align-items:center}ion-grid[_ngcontent-%COMP%]   .Menu[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{text-align:center;font-size:42px}ion-grid[_ngcontent-%COMP%]   .bpm_value[_ngcontent-%COMP%]{text-align:center;font-size:x-large}ion-grid[_ngcontent-%COMP%]   .TapBpm[_ngcontent-%COMP%]{justify-content:center}"]}),e})()}];let T=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.Bz.forChild(f)],u.Bz]}),e})(),b=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,h.u5,i.Pc,T]]}),e})()}}]);